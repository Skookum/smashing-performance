(function(){var f=function(c,a){return function(){return c.apply(a,arguments)}},e={}.hasOwnProperty,d=function(c,a){function d(){this.constructor=c}for(var f in a)e.call(a,f)&&(c[f]=a[f]);d.prototype=a.prototype;c.prototype=new d;c.__super__=a.prototype;return c};(function(c){var a,e;e=c.Model.prototype;a={undefined:void 0,"null":null,"true":!0,"false":!1};c.ViewModel=function(l){function h(i,b){this.onVirtual=f(this.onVirtual,this);this.createVirtual=f(this.createVirtual,this);this.virtual=f(this.virtual,
this);this.pass=f(this.pass,this);this.compute=f(this.compute,this);this.parseBinding=f(this.parseBinding,this);this.bindToNode=f(this.bindToNode,this);var g,k,a;this._virtuals={};this._bindings=[];h.__super__.constructor.apply(this,arguments);a=this.computes;for(g in a)k=a[g],this.compute(g,k)}d(h,l);h.prototype.set=function(i,b,g){var k,a;if(!g||!g.dependency)if(k=(null!=(a=this._virtuals)?a.hasOwnProperty(i):void 0)&&this._virtuals[i])return k.set.call(this,i,b,g,k);return e.set.apply(this,arguments)};
h.prototype.bindView=function(i,b){var g,a,c,d;null==b&&(b="body");g="*["+i+"]";a=$(b).find(g);$(b).is(g)&&(a=$(b).add(a));c=0;for(d=a.length;c<d;c++)g=a[c],this.bindToNode(i,g);return a};h.prototype.unbindView=function(){var i,b,g,a;a=this._bindings;b=0;for(g=a.length;b<g;b++)i=a[b],i.stop();return this._bindings=[]};h.prototype.isBoundTo=function(a){var b,g,c,d;d=this._bindings;g=0;for(c=d.length;g<c;g++)if(b=d[g],b.node===a)return!0;return!1};h.prototype.bindToNode=function(a,b){var g,c,d,e,h;
if(!this.isBoundTo(b)){c=$(b).attr(a);g=c.split(";");c=[];e=0;for(h=g.length;e<h;e++)d=g[e],c.push(this.parseBinding(b,a,d));h=[];d=0;for(e=c.length;d<e;d++)g=c[d],h.push(this.createBinding(g));return h}};h.prototype.parseBinding=function(a,b,g){var c;c=g.split("(");var g=c[0].trim(),d,e,h,j;h=c[1].trim().slice(0,-1).split(",");j=[];d=0;for(e=h.length;d<e;d++)c=h[d],j.push(this.parseArgument(c));return{node:a,viewModel:this,type:g,bindingAttr:b,args:j}};h.prototype.parseArgument=function(c){c=c.trim();
a.hasOwnProperty(c)?c=a[c]:isNaN(c)||(c=Number(c));return c};h.prototype.createBinding=function(a){var b;b=c.Binding[a.type];if(null!=b)return a=new b(a),a.start(),this._bindings.push(a),a;throw Error('Trying to create a binding of unknown type "'+a.type+'"');};h.prototype.get=function(a){c.Virtual.track(this,"change:"+a);return this.attributes[a]};h.prototype.compute=function(){var a,b;a=_.toArray(arguments);b=a.pop();a.push({get:b});return this.virtual.apply(this,a)};h.prototype.pass=function(){var a,
b;a=_.toArray(arguments);b=a.pop();a.push({reference:b});return this.virtual.apply(this,a)};h.prototype.virtual=function(){var a,b,g;b=_.toArray(arguments);g=b.pop();g.model=this;var c,d,e;e=[];c=0;for(d=b.length;c<d;c++)a=b[c],e.push(this.createVirtual(a,g));return e};h.prototype.createVirtual=function(a,b){var g;g=_.extend({},b,{attr:a});g=new c.Virtual(g);this._virtuals[a]=g;g.on("change",this.onVirtual);return g.run()};h.prototype.onVirtual=function(a){return this.set(a.attr,a.result,{dependency:!0})};
return h}(c.Model);return c.Model=c.ViewModel})(Backbone)}).call(this);
(function(){var f={}.hasOwnProperty,e=function(d,c){function a(){this.constructor=d}for(var e in c)f.call(c,e)&&(d[e]=c[e]);a.prototype=c.prototype;d.prototype=new a;d.__super__=c.prototype;return d};(function(d){var c,a,j,f,h,i;j=d.Collection.prototype;d.ViewCollection=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}e(a,b);a.prototype.list=function(){d.Virtual.track(this,"add remove reset change create sort");return this.models};return a}(d.Collection);d.Collection.prototype.model=
d.Model;c=function(a){return d.ViewCollection.prototype[a]=function(){d.Virtual.track(this,"add remove reset change create sort");return j[a].apply(this,arguments)}};i="get getByCid where pluck clone at toJSON".split(" ").concat("forEach each map reduce reduceRight find detect filter select reject every all some any include contains invoke max min sortBy sortedIndex toArray size first initial rest last without indexOf shuffle lastIndexOf isEmpty groupBy".split(" "));f=0;for(h=i.length;f<h;f++)a=i[f],
c(a);return d.Collection=d.ViewCollection})(Backbone)}).call(this);
(function(){var f=function(e,d){return function(){return e.apply(d,arguments)}};(function(e){e.Virtual=function(){function d(c){this.remove=f(this.remove,this);this.add=f(this.add,this);this.update=f(this.update,this);this.onChange=f(this.onChange,this);this.run=f(this.run,this);this.runSafe=f(this.runSafe,this);_.extend(this,c);this.dependencies=[];this.result=void 0}d._computations=[];d._dependencies=void 0;d.startTracking=function(){e.Virtual._dependencies=[];return e.Virtual._computations.push(e.Virtual._dependencies)};
d.stopTracking=function(){var c,a;c=e.Virtual._computations;a=c.pop();e.Virtual._dependencies=c.length?c[c.length-1]:void 0;return a};d.track=function(c,a){var d;return null!=(d=e.Virtual._dependencies)?d.push({model:c,event:a}):void 0};d.prototype.runSafe=function(){try{return this.get.call(this.model,this.attr,this)}catch(c){return this.fail}};d.prototype.run=function(){e.Virtual.startTracking();this.result=this.hasOwnProperty("fail")?this.runSafe():this.get.call(this.model,this.attr,this);this.update(e.Virtual.stopTracking());
this.trigger("change",this);return this.result};d.prototype.onChange=function(){return this.run()};d.prototype.update=function(c){var a,d,e,h;h=this.dependencies;d=0;for(e=h.length;d<e;d++)a=h[d],this.remove(a);d=0;for(e=c.length;d<e;d++)a=c[d],this.add(a);return this.dependencies=c};d.prototype.add=function(c){return c.model.on(c.event,this.onChange)};d.prototype.remove=function(c){return c.model.off(c.event,this.onChange)};d.prototype.get=function(c,a){return("function"===typeof a.reference?a.reference.call(this):
a.reference).get(c)};d.prototype.set=function(c,a,d,e){return("function"===typeof e.reference?e.reference.call(this):e.reference).set(c,a)};return d}();return _.extend(e.Virtual.prototype,e.Events)})(Backbone)}).call(this);
(function(){var f=function(e,d){return function(){return e.apply(d,arguments)}};(function(e){e.Binding=function(){function d(c){this.stop=f(this.stop,this);this.start=f(this.start,this);this.onViewChange=f(this.onViewChange,this);this.onCollectionChange=f(this.onCollectionChange,this);this.onModelChange=f(this.onModelChange,this);this.initialize=f(this.initialize,this);_.extend(this,c);this.initialize.apply(this,c.args)}d.prototype.initialize=function(){};d.prototype.onModelChange=function(){};d.prototype.onCollectionChange=
function(){};d.prototype.onViewChange=function(){};d.prototype.start=function(){this.viewModel.on("change:"+this.attribute,this.onModelChange);return this.onModelChange()};d.prototype.stop=function(){return this.viewModel.off("change:"+this.attribute,this.onModelChange)};return d}();return e.Binding.extend=e.Model.extend})(Backbone)}).call(this);
(function(){var f={}.hasOwnProperty,e=function(a,c){function d(){this.constructor=a}for(var e in c)f.call(c,e)&&(a[e]=c[e]);d.prototype=c.prototype;a.prototype=new d;a.__super__=c.prototype;return a},d=[].slice,c=function(a,c){return function(){return a.apply(c,arguments)}};(function(a){var f,l,h;a.Binding.visible=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}e(b,a);b.prototype.initialize=function(a){this.attribute=a};b.prototype.onModelChange=function(){return this.viewModel.get(this.attribute)?
$(this.node).show():$(this.node).hide()};return b}(a.Binding);a.Binding.text=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}e(b,a);b.prototype.initialize=function(a){this.attribute=a};b.prototype.onModelChange=function(){var a;a=this.viewModel.get(this.attribute);return $(this.node).text(a)};return b}(a.Binding);a.Binding.attr=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}e(b,a);b.prototype.initialize=function(a,b){this.domAttribute=a;
this.attribute=b};b.prototype.onModelChange=function(){var a;a=this.viewModel.get(this.attribute);return $(this.node).attr(this.domAttribute,a)};return b}(a.Binding);a.Binding.val=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}e(b,a);b.prototype.initialize=function(a){this.attribute=a};b.prototype.start=function(){$(this.node).on("keyup change",this.onViewChange);return b.__super__.start.apply(this,arguments)};b.prototype.onModelChange=function(){var a;a=this.viewModel.get(this.attribute);
return $(this.node).val(a)};b.prototype.onViewChange=function(){return this.viewModel.set(this.attribute,$(this.node).val())};b.prototype.stop=function(){b.__super__.stop.apply(this,arguments);return $(this.node).off("keyup change",this.onViewChange)};return b}(a.Binding);a.Binding.css=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}e(b,a);b.prototype.initialize=function(a,b,c){this.className=a;this.attribute=b;this.truth=null!=c?c:!0};b.prototype.onModelChange=function(){var a;
a=this.viewModel.get(this.attribute);return Boolean(this.truth)===Boolean(a)?$(this.node).addClass(this.className):$(this.node).removeClass(this.className)};return b}(a.Binding);a.Binding.style=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}e(b,a);b.prototype.initialize=function(a,b){this.styleProperty=a;this.attribute=b};b.prototype.onModelChange=function(){var a;a=this.viewModel.get(this.attribute);return $(this.node).css(this.styleProperty,a)};return b}(a.Binding);
a.Binding.on=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}e(b,a);b.prototype.initialize=function(){var a,b,c;c=arguments[0];b=arguments[1];a=3<=arguments.length?d.call(arguments,2):[];this.events=c;this.callback=b;this.args=a};b.prototype.start=function(){return $(this.node).on(this.events,this.onViewChange)};b.prototype.onViewChange=function(a){"function"===typeof a.preventDefault&&a.preventDefault();var b;if(null==(a=null!=(b=this.viewModel[this.callback])?b:this.viewModel.get(this.callback)))throw Error("'on' binding can't find callback '"+
this.callback+"' for '"+this.events+"'");return a.apply(this.viewModel,this.args)};b.prototype.stop=function(){return $(this.node).off(this.events,this.onViewChange)};return b}(a.Binding);a.Binding.each=function(d){function b(){this.renderItem=c(this.renderItem,this);return b.__super__.constructor.apply(this,arguments)}e(b,d);b.prototype.initialize=function(a){this.attr=a;this.container=$(this.node);this.itemTemplate=this.container.html();return this.container.html("")};b.prototype.start=function(){this.viewModel.on("change:"+
this.attr,this.onCollectionChange);return this.onCollectionChange()};b.prototype.onCollectionChange=function(){var b,c,d,e,f;this.container.html("");this.collection=this.viewModel.get(this.attr);if(this.collection instanceof a.Collection)return this.collection.off("add remove reset create sort",this.onCollectionChange),this.collection.each(this.renderItem),this.collection.on("add remove reset create sort",this.onCollectionChange);e=this.collection;f=[];c=0;for(d=e.length;c<d;c++)b=e[c],f.push(this.renderItem(b));
return f};b.prototype.renderItem=function(a){var b,c,d,e,f;e=$(this.itemTemplate);f=[];c=0;for(d=e.length;c<d;c++)b=e[c],this.container.append(b),f.push(a.bindView(this.bindingAttr,b));return f};b.prototype.stop=function(){return this.viewModel.off("change:"+this.attr,this.onCollectionChange)};return b}(a.Binding);f={x:"scrollLeft",y:"scrollTop"};h={x:"scrollWidth",y:"scrollHeight"};l={x:"clientWidth",y:"clientHeight"};return a.Binding.scroll=function(a){function b(){this.tweenScroll=c(this.tweenScroll,
this);this.startTween=c(this.startTween,this);this.stopTween=c(this.stopTween,this);this.onViewChange=c(this.onViewChange,this);return b.__super__.constructor.apply(this,arguments)}e(b,a);b.prototype.initialize=function(a,b,c){this.attribute=a;this.axis=null!=b?b:"y";this.speed=null!=c?c:0.5;this.speed=isNaN(c)?parseInt(c,10):c;this.scrollProp=f[this.axis];this.outerProp=h[this.axis];this.innerProp=l[this.axis];this.target=0;return this.scrollTimeout=this.last=void 0};b.prototype.start=function(){$(this.node).on("scroll",
this.onViewChange);return b.__super__.start.apply(this,arguments)};b.prototype.onViewChange=function(){var a;if(null==this.scrollTimeout)return a=this.getScrollPercent(),this.viewModel.set(this.attribute,a,{scrollBinding:!0})};b.prototype.onModelChange=function(a,b,c){if(!(null!=c&&c.scrollBinding))return b=this.viewModel.get(this.attribute),a=this.node[this.outerProp]-this.node[this.innerProp],this.target=b*a,this.startTween()};b.prototype.getScrollPercent=function(){var a,b;b=this.node[this.scrollProp];
a=this.node[this.outerProp]-this.node[this.innerProp];return 0<a?b/a:0};b.prototype.stopTween=function(){clearTimeout(this.scrollTimeout);return this.last=this.scrollTimeout=void 0};b.prototype.startTween=function(){this.stopTween();return this.tweenScroll()};b.prototype.tweenScroll=function(){var a;a=this.node[this.scrollProp];this.node[this.scrollProp]=a+(this.target-a)*this.speed;if(2>=Math.abs(a-this.target)||2>=Math.abs(this.node[this.scrollProp]-this.last))this.stopTween(),this.node[this.scrollProp]=
this.target;else return this.last=a,this.scrollTimeout=setTimeout(this.tweenScroll,30)};b.prototype.stop=function(){b.__super__.stop.apply(this,arguments);return $(this.node).off("scroll",this.onViewChange)};return b}(a.Binding)})(Backbone)}).call(this);
